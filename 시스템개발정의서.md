ğŸ“˜ í”„ë¡œì íŠ¸ ê°œë°œì •ì˜ì„œ v1.0
(Neely RAG ê¸°ë°˜ ë©€í‹°ëª¨ë¸ ìë™ë§¤ë§¤ íŒë‹¨ ì‹œìŠ¤í…œ)
1ï¸âƒ£ í”„ë¡œì íŠ¸ ëª©í‘œ
ğŸ¯ í•µì‹¬ ëª©í‘œ

ê¸€ë Œ ë‹ë¦¬(NEoWave) êµìœ¡ìë£Œ(PDF/PNG ìŠ¤ìº”) ê¸°ë°˜ RAG ì‹œìŠ¤í…œì„ êµ¬ì¶•í•˜ê³ ,

âœ… ChatGPT = Primary Wave Count

âœ… Gemini = Alternative Count + Final Judge

âœ… ê³µê²©í˜• ì˜ì‚¬ê²°ì • ì—”ì§„ìœ¼ë¡œ LONG/SHORT ì„ íƒ

ì„ ìˆ˜í–‰í•˜ëŠ” êµ¬ì¡°í™”ëœ ìë™ë§¤ë§¤ íŒë‹¨ ì±—ë´‡ ì‹œìŠ¤í…œ êµ¬ì¶•

âš ï¸ ë³¸ ì‹œìŠ¤í…œì€ ì—°êµ¬/ì „ëµ ì„¤ê³„ ëª©ì ì´ë©° íˆ¬ì ì¡°ì–¸ì´ ì•„ë‹˜.

2ï¸âƒ£ ì „ì²´ ì•„í‚¤í…ì²˜
[ì‚¬ìš©ì]
    â†“
Next.js (Frontend + API)
    â†“
Supabase (Auth / DB / Storage / pgvector)
    â†“
OCR Pipeline (PNG â†’ Text)
    â†“
RAG Retrieval
    â†“
â‘  ChatGPT (Primary Count)
â‘¡ Gemini (Alternative Count)
    â†“
â‘¢ Gemini Judge (ê³µê²©í˜• ì ìˆ˜ ì„ íƒ)
    â†“
Signal JSON ì €ì¥
3ï¸âƒ£ ê¸°ìˆ  ìŠ¤íƒ
Frontend

Next.js (App Router)

Tailwind UI

Streaming Response

Backend

Next.js Route Handlers

Supabase Edge Functions

DB

Supabase Postgres

pgvector (vector similarity search)

AI ëª¨ë¸

OpenAI (ChatGPT)

Google Gemini (analysis + judge)

OCR

Google Cloud Vision API (ê¶Œì¥)

ì´ìœ : ìŠ¤ìº” êµìœ¡ìë£Œ ì¸ì‡„ë¬¼ ì •í™•ë„ ë†’ìŒ

4ï¸âƒ£ í•µì‹¬ ì„¤ê³„ ì›ì¹™
ğŸ§© ì›ì¹™ 1: ê·œì¹™ ìš°ì„ 

RAGì— ì—†ëŠ” ê·œì¹™ì€ â€œê°€ì •â€ìœ¼ë¡œ ì²˜ë¦¬

âš”ï¸ ì›ì¹™ 2: ê³µê²©í˜•ì´ì§€ë§Œ ê·œì¹™ ìœ„ë°˜ ì‹œ ì¦‰ì‹œ íƒˆë½
ğŸ“‰ ì›ì¹™ 3: í•­ìƒ ë¬´íš¨í™” ì¡°ê±´ í¬í•¨
ğŸ§  ì›ì¹™ 4: ìƒíƒœë¨¸ì‹  ê¸°ë°˜
5ï¸âƒ£ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ (Supabase)
5.1 documents
ì»¬ëŸ¼	íƒ€ì…
id	uuid
title	text
source_type	text (png/pdf)
created_at	timestamp
5.2 document_pages
ì»¬ëŸ¼	íƒ€ì…
id	uuid
document_id	uuid
page_no	int
image_path	text
5.3 knowledge_chunks (RAG í•µì‹¬)
ì»¬ëŸ¼	íƒ€ì…
id	uuid
document_id	uuid
chunk_type	text (rule/exception/definition)
section_title	text
content	text
embedding	vector
source_page	int
5.4 conversations
ì»¬ëŸ¼	íƒ€ì…
id	uuid
user_id	uuid
created_at	timestamp
5.5 runs (íŒì • ë¡œê·¸)
ì»¬ëŸ¼	íƒ€ì…
id	uuid
conversation_id	uuid
user_query	text
gpt_output	jsonb
gemini_alt	jsonb
final_decision	jsonb
created_at	timestamp
6ï¸âƒ£ PNG OCR ì²˜ë¦¬ ì„¤ê³„
6.1 íë¦„
Upload PNG â†’
Store in Supabase â†’
Google Vision OCR â†’
Gemini êµ¬ì¡°í™” â†’
Chunking â†’
Embedding â†’
knowledge_chunks ì €ì¥
6.2 êµ¬ì¡°í™” JSON ì˜ˆì‹œ
{
  "section": "Impulse Wave Rules",
  "rules": [
    {
      "text": "Wave 2 must not retrace beyond start of wave 1",
      "type": "rule"
    }
  ],
  "exceptions": []
}
7ï¸âƒ£ RAG ë°ì´í„° ì €ì¥ ìœ„ì¹˜ (ìš”ì•½)
7.1 í˜„ì¬ í”„ë¡œì íŠ¸ RAG (Supabase)
ë°ì´í„° ì €ì¥ì²˜: Supabase ì „ë¶€
- ì›ë³¸ íŒŒì¼: Supabase Storage ë²„í‚· documents
- ë©”íƒ€/í˜ì´ì§€: Postgres í…Œì´ë¸” documents, document_pages
- RAG ê²€ìƒ‰ìš©: Postgres í…Œì´ë¸” knowledge_chunks (pgvector embedding)
ë°ì´í„° ë„£ëŠ” ë°©ë²•: ì•±ì˜ /upload í˜ì´ì§€ì—ì„œ PNG ë˜ëŠ” PDF ì—…ë¡œë“œ â†’ ìë™ OCRÂ·ì²­í‚¹Â·ì„ë² ë”© í›„ knowledge_chunksì— ì €ì¥
7.2 êµ¬ê¸€ íŒŒì¼ ì„œì¹˜ RAG (Gemini File Search)ë¥¼ ì“¸ ê²½ìš°
ë°ì´í„° ì €ì¥ì²˜: êµ¬ê¸€ì´ ê´€ë¦¬ (ìš°ë¦¬ê°€ ì§€ì •í•˜ëŠ” ì„œë²„ ì—†ìŒ)
- Gemini API File Search: APIë¡œ íŒŒì¼ ì—…ë¡œë“œ â†’ êµ¬ê¸€ ìª½ì—ì„œ ì €ì¥Â·ì²­í‚¹Â·ì„ë² ë”©Â·ê²€ìƒ‰ê¹Œì§€ ê´€ë¦¬
- Vertex AI RAG: ë°ì´í„°ëŠ” Google Drive ë˜ëŠ” Google Cloud Storageì— ë‘ê³ , RAG ì½”í¼ìŠ¤ë¡œ import (rag.import_files ë“±)
ë°ì´í„° ë„£ëŠ” ë°©ë²• (Gemini File Search): í´ë¼ì´ì–¸íŠ¸/ì„œë²„ì—ì„œ Gemini Files APIë¡œ íŒŒì¼ ì—…ë¡œë“œ â†’ ëŒ€í™” ì‹œ File Search íˆ´ ì‚¬ìš©. ë³„ë„ DB í…Œì´ë¸” ì—†ìŒ.
8ï¸âƒ£ RAG Retrieval ì„¤ê³„ (í˜„ì¬ Supabase ê¸°ì¤€)
ê²€ìƒ‰ ê¸°ì¤€

cosine similarity top_k = 8

ë™ì¼ ë¬¸ì„œ ê°€ì¤‘ì¹˜

rule/exception ìš°ì„ 

í”„ë¡¬í”„íŠ¸ ì‚½ì… êµ¬ì¡°
[Neely Rules Context]
- Rule 1 ...
- Exception ...
- Page 14 ...
8ï¸âƒ£ ëª¨ë¸ ì—­í•  ì •ì˜
ğŸŸ¢ 8.1 ChatGPT (Primary Engine)
ì—­í• 

ë³´ìˆ˜ì  ì¹´ìš´íŒ…

ê·œì¹™ ìœ„ë°˜ íƒì§€

ëª…í™•í•œ ë¬´íš¨í™” ì œì‹œ

ì¶œë ¥ JSON ìŠ¤í‚¤ë§ˆ
{
  "direction": "LONG | SHORT | HOLD",
  "scenario_label": "",
  "confirmation_trigger": "",
  "invalidation_level": "",
  "risk_reward_estimate": 0,
  "rule_citations": []
}
ğŸ”µ 8.2 Gemini (Alternative + Judge)
Step 1: Alternative Count ìƒì„±

GPTì™€ ë‹¤ë¥¸ ê´€ì  ì‹œë„

ëŒ€ì•ˆ ì‹œë‚˜ë¦¬ì˜¤ êµ¬ì„±

Step 2: Judge (ê³µê²©í˜• ì ìˆ˜í™”)
9ï¸âƒ£ ê³µê²©í˜• ì ìˆ˜í™” ì•Œê³ ë¦¬ì¦˜
í‰ê°€ í•­ëª©
í•­ëª©	ì„¤ëª…	ì ìˆ˜
Rule Validity	ê·œì¹™ ìœ„ë°˜ ì—†ìŒ	í•„ìˆ˜
Invalidation Clarity	ëª…í™•ì„±	0~2
Risk Reward	2R ì´ìƒ	0~2
Structure Simplicity	ë‹¨ìˆœì„±	0~2
Resolution Speed	ê³§ í™•ì •	0~2
ì„ íƒ ê·œì¹™
if rule_invalid â†’ discard
if both valid:
    if score_diff >= 2 â†’ higher score ì„ íƒ
    else â†’ smaller stop distance ì„ íƒ
if RR < 1.5 â†’ HOLD
10ï¸âƒ£ ìƒíƒœë¨¸ì‹  ì„¤ê³„

ìƒíƒœ ê°’:

WAITING

BREAKOUT_WATCH

CONFIRMED_IMPULSE

CONFIRMED_CORRECTION

INVALIDATED_RESET

Gemini JudgeëŠ” ë§¤ í˜¸ì¶œë§ˆë‹¤:

í˜„ì¬ ìƒíƒœ

ë‹¤ìŒ ì „ì´ ì¡°ê±´

ë¦¬ì…‹ ì¡°ê±´

ì„ ì—…ë°ì´íŠ¸

11ï¸âƒ£ Next.js í´ë” êµ¬ì¡°
/app
  /api
    /upload
    /chat
    /index-doc
  /dashboard
/lib
  /rag
  /ocr
  /models
     chatgpt.ts
     gemini.ts
  /judge
  /state-machine
12ï¸âƒ£ API ì²˜ë¦¬ íë¦„
/api/chat
1. RAG retrieve
2. call ChatGPT
3. call Gemini (alt)
4. call Gemini (judge)
5. save run
6. return final_decision
13ï¸âƒ£ ìµœì¢… Signal JSON (TradingView ëŒ€ë¹„)
{
  "symbol": "BTCUSDT",
  "timeframe": "4H",
  "decision": "LONG",
  "entry_trigger": "Break above 45200",
  "invalidation": "Below 43800",
  "risk_percent": 1,
  "alternate_scenario": "...",
  "state": "BREAKOUT_WATCH"
}
14ï¸âƒ£ ë¦¬ìŠ¤í¬ ê´€ë¦¬ ê·œì¹™

ìµœëŒ€ ì†ì‹¤ = ê³„ì¢Œì˜ 1~2%

ë™ì‹œ í¬ì§€ì…˜ ì œí•œ

3ì—°ì† ì†ì‹¤ ì‹œ ì‹œìŠ¤í…œ ìë™ HOLD

15ï¸âƒ£ MVP ê°œë°œ ë‹¨ê³„
Phase 1

PNG OCR + RAG êµ¬ì¶•

ChatGPT ë‹¨ì¼ ë¶„ì„

Phase 2

Gemini ëŒ€ì•ˆ + Judge

JSON Signal ì €ì¥

Phase 3

ìƒíƒœë¨¸ì‹ 

TradingView Webhook ì—°ë™